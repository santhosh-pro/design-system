<ui-base-input
  [title]="label()"
  [width]="width()"
  [isRequiredField]="hasRequiredValidator()"
>
  <!-- Input Slot -->
  <div input
    class="relative flex items-center w-full bg-white border border-[var(--color-primary-400)] rounded-md shadow-sm ring-1 ring-[var(--color-primary-400)] focus-within:ring-2 transition-all"
    [ngClass]="{
         'border-error-600 ring-error-600 focus-within:ring-2': formControl.touched && formControl.errors,
        '!border-gray-500 !ring-0 focus-within:!ring-2 focus-within:!ring-[var(--color-primary-500)] focus-within:!border-[var(--color-primary-500)]': !(formControl.touched && formControl.errors),
         'bg-neutral-100 cursor-not-allowed': formControl.disabled,
       }">
    <div
      class="flex items-center h-[46px] w-full bg-transparent border-none outline-none focus:ring-0 cursor-pointer select-none"
      tabindex="0"
      (click)="openDialog()"
      (focus)="onFocus()"
      (blur)="onBlur()"
      (keydown.enter)="openDialog()"
      (keydown.space)="$event.preventDefault(); openDialog()"
    >
      <span
        class="text-sm truncate flex-1 px-3"
        [class.text-neutral-400]="!displayText().length"
      >
        {{ displayText() || placeholder() || 'Select items' }}
      </span>
      @if (displayText().length) {
        <button
          (click)="clearAll($event); $event.stopPropagation()"
          class="mr-2 p-1 text-neutral-400 hover:bg-neutral-100 hover:text-[var(--color-primary-500)] rounded-full transition-colors"
          type="button"
          aria-label="Clear selection"
        >
          <svg class="w-4 h-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
            <path
              d="M12 2a10 10 0 110 20 10 10 0 010-20zm3.59 5L12 10.59 8.41 7 7 8.41 10.59 12 7 15.59 8.41 17 12 13.41 15.59 17 17 15.59 13.41 12 17 8.41 15.59 7z"
              fill="currentColor"
            />
          </svg>
        </button>
      }
      <div class="pointer-events-none mr-2">
        <svg
          class="w-5 h-5 text-neutral-400 transition-transform duration-200"
          fill="currentColor"
          viewBox="0 0 20 20"
          aria-hidden="true"
        >
          <path
            d="M7.41 8.58L12 13.17l4.59-4.59L18 10l-6 6-6-6 1.41-1.42z"
            fill="currentColor"
          />
        </svg>
      </div>
    </div>
  </div>

  <!-- Error Slot -->
  @if (formControl.touched && formControl.errors) {
    <div error class="ml-2 text-left">
      <span class="text-xs text-[var(--color-error-500)]">{{ formControl.errors | humanizeFormMessages: errorMessages() }}</span>
    </div>
  } @else if (showErrorSpace()) {
    <div error class="text-left">
      <span class="text-xs text-transparent">.</span>
    </div>
  }
</ui-base-input>