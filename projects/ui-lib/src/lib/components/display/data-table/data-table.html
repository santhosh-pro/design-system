<div class="flex flex-col bg-white rounded-2xl overflow-hidden shadow-lg border border-gray-200"
  [style.height]="enableSearch() ? 'calc(100vh - 200px)' : 'calc(100vh - 136px)'">

  <!-- Search Bar - Disabled only during initial load -->
  @if (enableSearch() || headerComponents.length > 0) {
  <div class="flex px-6 py-5 border-b border-gray-300 justify-between items-center bg-white flex-shrink-0">
    @if (enableSearch()) {
    <div class="flex-1 max-w-md">
      <ui-search-field 
        placeholder="Search..." 
        type="search" 
        [width]="'md'" 
        (valueChange)="onSearchTextChanged($event)"
        iconSrc="edit.svg"
        >
      </ui-search-field>
    </div>
    }
    <div class="flex items-center gap-4">
      <ng-content></ng-content>
    </div>
  </div>
  }

  <!-- Table Container -->
  <div class="flex-1 overflow-auto relative h-full" [class.overflow-x-auto]="enableHorizontallyScrollable()">
    <div class="h-full flex flex-col">
      <table #table class="w-full border-collapse min-w-[1400px] flex-1" style="border-spacing: 0; table-layout: auto;">
        
        <!-- Table Header - Disabled only during initial load -->
        <thead class="sticky top-0 bg-gray-100 z-20 flex-shrink-0">
          @for (level of getHeaderLevels(); track level) {
          <tr sortableTable 
            (sortChange)="onSortChanged($event)"
            class="text-xs font-semibold text-gray-700 uppercase tracking-wider bg-gray-100 border-b-2 border-gray-300"
            [class.opacity-50]="getState() === 'initializing'"
            [class.pointer-events-none]="getState() === 'initializing'">
            
            <!-- Expandable Column Header -->
            @if (expandableComponent() && level === 0) {
            <th [attr.rowspan]="getHeaderRowSpan()"
              class="sticky left-0 z-20 bg-gray-100 w-12 px-4 py-4 text-center border-r-2 border-gray-300 shadow-[2px_0_4px_rgba(0,0,0,0.1)]">
            </th>
            }

            <!-- Checkbox Column Header -->
            @if (enableRowSelection() && level === 0) {
            <th [attr.rowspan]="getHeaderRowSpan()"
              class="sticky left-0 z-20 bg-gray-100 w-12 px-4 py-4 text-center border-r-2 border-gray-300 shadow-[2px_0_4px_rgba(0,0,0,0.1)]">
              @if (getState() !== 'initializing') {
              <input 
                type="checkbox" 
                [formControl]="selectAllControl"
                class="h-4 w-4 accent-primary-600 focus:ring-primary-500 disabled:accent-gray-400 disabled:opacity-60 cursor-pointer"
                aria-label="Select all rows" />
              }
            </th>
            }

            @for (cell of getHeaderCellsAtLevel(level); track $index; let colIndex = $index) {
            <th [attr.colspan]="cell.colspan" [attr.rowspan]="cell.rowspan" [attr.data-sortable-key]="cell.sortKey"
              class="relative cursor-pointer px-4 py-4 text-xs font-semibold text-gray-700 uppercase tracking-wider hover:bg-gray-200 bg-gray-100 border-r-2 border-gray-300 transition-colors duration-200"
              [class]="getHeaderThClass(cell)"
              [class.opacity-50]="getState() === 'initializing'"
              [class.pointer-events-none]="getState() === 'initializing'">
              <div class="flex items-center gap-2" [class]="getFlexJustifyClass(cell)">
                <span class="whitespace-normal break-words leading-tight">{{ cell.title }}</span>
              </div>
            </th>
            }
          </tr>
          }
        </thead>

        <!-- MODIFIED: Show loading ONLY for initial load -->
        @switch (getState()) {
        @case ('initializing') {
        <!-- Initial Load Only - Shows spinner when isLoading && no data -->
        <tbody class="relative z-0 flex-1">
          <tr class="h-full">
            <td
              [attr.colspan]="allLeafColumns().length + (enableRowSelection() ? 1 : 0) + (expandableComponent() ? 1 : 0)"
              class="h-full px-6 py-0 bg-gray-50 align-middle">
              <div class="h-full flex items-center justify-center">
                <div class="flex flex-col items-center space-y-6 max-w-md mx-auto">
                  <div class="flex items-center justify-center w-20 h-20 rounded-full bg-primary-100">
                    <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600"></div>
                  </div>
                  <div class="text-center space-y-3">
                    <h3 class="text-xl md:text-2xl font-bold text-gray-900 leading-tight">
                      Loading...
                    </h3>
                    <p class="text-sm md:text-base text-gray-500 leading-relaxed">
                      Fetching your records
                    </p>
                  </div>
                </div>
              </div>
            </td>
          </tr>
        </tbody>
        }

        @case ('loading') {
        <!-- Subsequent loads - Show data immediately, no spinner -->
        <!-- This case only triggers if showLoadingOnlyInitial=false -->
        @if (data().length > 0) {
        <tbody class="relative z-0 flex-1">
          @for (item of data(); track $index; let i = $index) {
          <tr (click)="onRowClicked(item)"
            class="transition-all duration-200 hover:bg-blue-50 bg-white border-b border-gray-200 group"
            [class.cursor-pointer]="enableClickableRows()" [class.bg-blue-100]="isRowSelected(item)"
            [class.hover:bg-blue-200]="isRowSelected(item)">
            
            <!-- All your existing row content -->
            @if (expandableComponent()) {
            <td
              class="sticky left-0 z-10 bg-white w-12 px-4 py-4 text-center border-r-2 border-gray-300 shadow-[2px_0_4px_rgba(0,0,0,0.05)] group-hover:bg-blue-50 transition-colors duration-200"
              [class.bg-blue-100]="isRowSelected(item)" [class.group-hover:bg-blue-200]="isRowSelected(item)">
              <div (click)="onRowExpandedClicked(i); $event.stopPropagation()"
                class="mx-auto flex items-center justify-center h-[40px] w-[40px] rounded-full bg-gray-50 hover:bg-gray-100 cursor-pointer transition-all duration-500">
                <svg class="h-[20px] w-[20px] text-gray-500" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
                  fill="none">
                  <path d="M7.41 8.58L12 13.17L16.59 8.58L18 10L12 16L6 10L7.41 8.58Z" fill="currentColor" />
                </svg>
              </div>
            </td>
            }

            @if (enableRowSelection()) {
            <td
              class="sticky left-0 z-10 bg-white w-12 px-4 py-4 text-center border-r-2 border-gray-300             shadow-[2px_0_4px_rgba(0,0,0,0.05)] group-hover:bg-blue-50 transition-colors duration-200"
              [class.bg-blue-100]="isRowSelected(item)" [class.group-hover:bg-blue-200]="isRowSelected(item)">
              <input type="checkbox" [formControl]="getItemControl(item)"
                class="h-4 w-4 accent-primary-600 focus:ring-primary-500 disabled:accent-gray-400 disabled:opacity-60 cursor-pointer"
                aria-label="Select row" />
            </td>
            }

            @for (column of allLeafColumns(); track column; let colIndex = $index) {
            <td
              class="px-4 py-4 relative text-sm text-gray-900 bg-white border-r border-gray-200 group-hover:bg-blue-50 transition-colors duration-200"
              [class]="getCellClass(column)" [class.bg-blue-100]="isRowSelected(item)"
              [class.group-hover:bg-blue-200]="isRowSelected(item)">

              @switch (column.type) {
              @default {
              <span class="text-sm text-gray-800 block truncate" [class]="column.textConfig?.textColorClass || ''"
                [title]="getPropertyValue(item, column)">
                {{ getPropertyValue(item, column) }}
              </span>
              }

              @case ('text') {
              <span class="text-sm text-gray-800 block truncate" [class]="column.textConfig?.textColorClass || ''"
                [title]="getPropertyValue(item, column)">
                {{ getPropertyValue(item, column) }}
              </span>
              }

              @case ('date') {
              <div class="flex items-center gap-3" [class]="getFlexJustify(column)">
                @if (column.dateConfig?.showIcon ?? true) {
                <svg class="h-4 w-4 text-gray-500 flex-shrink-0" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
                  fill="none">
                  <path
                    d="M19 19H5V8H19M16 1V3H8V1H6V3H5C3.89 3 3 3.89 3 5V19C3 19.5304 3.21071 20.0391 3.58579 20.4142C3.96086 20.7893 4.46957 21 5 21H19C19.5304 21 20.0391 20.7893 20.4142 20.4142C20.7893 20.0391 21 19.5304 21 19V5C21 3.89 20.1 3 19 3H18V1M17 12H12V17H17V12Z"
                    fill="currentColor" />
                </svg>
                }
                @let date = getPropertyValue(item, column);
                @if (date && date != 'null') {
                <span class="text-sm whitespace-nowrap">
                  {{ date | date: (column.dateConfig?.dateFormat ?? 'MMM d, y, h:mm a') }}
                </span>
                }
              </div>
              }

              @case ('badge') {
              @let badgeProperty = getBadgeProperty(item, column);
              <div class="flex items-center" [class]="getFlexJustify(column)">
                <ui-status-badge 
                  [backgroundColorClass]="badgeProperty?.backgroundColorClass ?? null"
                  [indicatorColor]="badgeProperty?.indicatorColorClass ?? null"
                  [borderColorClass]="badgeProperty?.borderColorClass ?? null"
                  [textColorClass]="badgeProperty?.textColorClass ?? null" 
                  [isUpperCase]="true"
                  [status]="badgeProperty?.displayText ?? 'Unknown'">
                </ui-status-badge>
              </div>
              }

              @case ('custom') {
              @if (column.component) {
              <div class="flex items-center">
                <ui-dynamic-renderer 
                  [component]="column.component" 
                  [rowData]="item" 
                  [data]="column.customConfig?.data"
                  [rowPosition]="$index + 1" 
                  [isLastRow]="$last" 
                  (actionPerformed)="onRowActionPerformed($event)">
                </ui-dynamic-renderer>
              </div>
              }
              }

              @case ('actions') {
              <div class="flex items-center justify-center gap-2" [class]="getFlexJustify(column)">
                <!-- Icon Actions -->
                @if (column.actionsConfig?.iconActions) {
                @for (iconAction of column.actionsConfig?.iconActions; track iconAction) {
                <button type="button" (click)="onActionClicked(iconAction.actionKey, item, $event)"
                  class="flex items-center justify-center h-8 w-8 cursor-pointer rounded-lg hover:bg-gray-100 active:bg-gray-200 transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50"
                  [title]="iconAction.label || iconAction.actionKey">
                  <ui-svg-icon [src]="iconAction.iconPath" [size]="16" class="text-gray-600"></ui-svg-icon>
                </button>
                }
                }

                <!-- Three-dot Menu -->
                @if (column.actionsConfig?.threeDotMenuActions) {
                @let menuActions = getContextMenuActions(column.actionsConfig?.threeDotMenuActions, item);
                @if (menuActions.length > 0) {
                <ui-context-menu-button 
                  (actionClick)="onActionClicked($event, item, null)" 
                  [contextActions]="menuActions"
                  class="relative">
                  <button type="button"
                    class="flex items-center justify-center h-8 w-8 cursor-pointer rounded-lg hover:bg-gray-100 active:bg-gray-200 transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50"
                    title="More actions">
                    <svg class="w-4 h-4 text-gray-600" fill="currentColor" viewBox="0 0 20 20">
                      <path
                        d="M10 6a2 2 0 110-4 2 2 0 010 4zM10 12a2 2 0 110-4 2 2 0 010 4zM10 18a2 2 0 110-4 2 2 0 010 4z">
                      </path>
                    </svg>
                  </button>
                </ui-context-menu-button>
                }
                }

                <!-- Custom Components -->
                @if (column.actionsConfig?.components) {
                <div class="flex items-center gap-1">
                  @for (component of column.actionsConfig?.components; track $index) {
                  <ui-dynamic-renderer 
                    [component]="component" 
                    [rowData]="item" 
                    [data]="column.customConfig?.data"
                    [rowPosition]="$index + 1" 
                    [isLastRow]="$last" 
                    (actionPerformed)="onRowActionPerformed($event)">
                  </ui-dynamic-renderer>
                  }
                </div>
                }
              </div>
              }
              }
            </td>
            }

          </tr>

          <!-- Expanded Row -->
          @if (expandableComponent() && i === expandedRowIndex()) {
          <tr class="transition-all duration-700">
            <td
              [attr.colspan]="allLeafColumns().length + (enableRowSelection() ? 1 : 0) + (expandableComponent() ? 1 : 0)">
              <div class="mx-4 my-4 p-4 bg-gray-50 rounded-lg">
                <ui-dynamic-renderer 
                  [component]="expandableComponent()" 
                  [rowData]="item"
                  (actionPerformed)="onCellActionPerformed($event)">
                </ui-dynamic-renderer>
              </div>
            </td>
          </tr>
          }
          }
        </tbody>
        } @else {
        <!-- Empty during loading - rare case -->
        <tbody class="relative z-0 flex-1">
          <tr class="h-full">
            <td
              [attr.colspan]="allLeafColumns().length + (enableRowSelection() ? 1 : 0) + (expandableComponent() ? 1 : 0)"
              class="h-full px-6 py-0 bg-gray-50 align-middle">
              <div class="h-full flex items-center justify-center">
                <div class="flex flex-col items-center space-y-6 max-w-md mx-auto">
                  <div class="flex items-center justify-center w-20 h-20 rounded-full bg-primary-100">
                    <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600"></div>
                  </div>
                  <div class="text-center space-y-3">
                    <h3 class="text-xl md:text-2xl font-bold text-gray-900 leading-tight">
                      Refreshing...
                    </h3>
                    <p class="text-sm md:text-base text-gray-500 leading-relaxed">
                      Updating your records
                    </p>
                  </div>
                </div>
              </div>
            </td>
          </tr>
        </tbody>
        }
        }
        

        @case ('error') {
        <!-- Error State -->
        <tbody class="relative z-0 flex-1">
          <tr class="h-full">
            <td
              [attr.colspan]="allLeafColumns().length + (enableRowSelection() ? 1 : 0) + (expandableComponent() ? 1 : 0)"
              class="h-full px-6 py-0 bg-gray-50 align-middle">
              <div class="h-full flex items-center justify-center">
                <div class="flex flex-col items-center space-y-6 max-w-md mx-auto">
                  <div class="flex items-center justify-center w-20 h-20 rounded-full bg-red-100">
                    <svg class="w-10 h-10 text-red-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                  </div>
                  <div class="text-center space-y-3">
                    <h3 class="text-xl md:text-2xl font-bold text-gray-900 leading-tight">
                      Failed to load data
                    </h3>
                    <p class="text-sm md:text-base text-gray-500 leading-relaxed">
                      {{ getErrorMessage() || 'Something went wrong while loading your data.' }}
                    </p>
                    <div class="pt-2">
                      <button 
                        type="button"
                        class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-lg text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 transition-colors duration-200"
                        (click)="onRetryLoad()">
                        Try Again
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </td>
          </tr>
        </tbody>
        }

        @case ('success') {
        <!-- Success State - Show data immediately -->
        @if (data().length > 0) {
        <tbody class="relative z-0 flex-1">
          @for (item of data(); track $index; let i = $index) {
          <tr (click)="onRowClicked(item)"
            class="transition-all duration-200 hover:bg-blue-50 bg-white border-b border-gray-200 group"
            [class.cursor-pointer]="enableClickableRows()" [class.bg-blue-100]="isRowSelected(item)"
            [class.hover:bg-blue-200]="isRowSelected(item)">

            <!-- Expandable Column -->
            @if (expandableComponent()) {
            <td
              class="sticky left-0 z-10 bg-white w-12 px-4 py-4 text-center border-r-2 border-gray-300 shadow-[2px_0_4px_rgba(0,0,0,0.05)] group-hover:bg-blue-50 transition-colors duration-200"
              [class.bg-blue-100]="isRowSelected(item)" [class.group-hover:bg-blue-200]="isRowSelected(item)">
              <div (click)="onRowExpandedClicked(i); $event.stopPropagation()"
                class="mx-auto flex items-center justify-center h-[40px] w-[40px] rounded-full bg-gray-50 hover:bg-gray-100 cursor-pointer transition-all duration-500">
                <svg class="h-[20px] w-[20px] text-gray-500" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
                  fill="none">
                  <path d="M7.41 8.58L12 13.17L16.59 8.58L18 10L12 16L6 10L7.41 8.58Z" fill="currentColor" />
                </svg>
              </div>
            </td>
            }

            <!-- Checkbox Column -->
            @if (enableRowSelection()) {
            <td
              class="sticky left-0 z-10 bg-white w-12 px-4 py-4 text-center border-r-2 border-gray-300 shadow-[2px_0_4px_rgba(0,0,0,0.05)] group-hover:bg-blue-50 transition-colors duration-200"
              [class.bg-blue-100]="isRowSelected(item)" [class.group-hover:bg-blue-200]="isRowSelected(item)">
              <input type="checkbox" [formControl]="getItemControl(item)"
                class="h-4 w-4 accent-primary-600 focus:ring-primary-500 disabled:accent-gray-400 disabled:opacity-60 cursor-pointer"
                aria-label="Select row" />
            </td>
            }

            @for (column of allLeafColumns(); track column; let colIndex = $index) {
            <td
              class="px-4 py-4 relative text-sm text-gray-900 bg-white border-r border-gray-200 group-hover:bg-blue-50 transition-colors duration-200"
              [class]="getCellClass(column)" [class.bg-blue-100]="isRowSelected(item)"
              [class.group-hover:bg-blue-200]="isRowSelected(item)">

              @switch (column.type) {
              @default {
              <span class="text-sm text-gray-800 block truncate" [class]="column.textConfig?.textColorClass || ''"
                [title]="getPropertyValue(item, column)">
                {{ getPropertyValue(item, column) }}
              </span>
              }

              @case ('text') {
              <span class="text-sm text-gray-800 block truncate" [class]="column.textConfig?.textColorClass || ''"
                [title]="getPropertyValue(item, column)">
                {{ getPropertyValue(item, column) }}
              </span>
              }

              @case ('date') {
              <div class="flex items-center gap-3" [class]="getFlexJustify(column)">
                @if (column.dateConfig?.showIcon ?? true) {
                <svg class="h-4 w-4 text-gray-500 flex-shrink-0" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
                  fill="none">
                  <path
                    d="M19 19H5V8H19M16 1V3H8V1H6V3H5C3.89 3 3 3.89 3 5V19C3 19.5304 3.21071 20.0391 3.58579 20.4142C3.96086 20.7893 4.46957 21 5 21H19C19.5304 21 20.0391 20.7893 20.4142 20.4142C20.7893 20.0391 21 19.5304 21 19V5C21 3.89 20.1 3 19 3H18V1M17 12H12V17H17V12Z"
                    fill="currentColor" />
                </svg>
                }
                @let date = getPropertyValue(item, column);
                @if (date && date != 'null') {
                <span class="text-sm whitespace-nowrap">
                  {{ date | date: (column.dateConfig?.dateFormat ?? 'MMM d, y, h:mm a') }}
                </span>
                }
              </div>
              }

              @case ('badge') {
              @let badgeProperty = getBadgeProperty(item, column);
              <div class="flex items-center" [class]="getFlexJustify(column)">
                <ui-status-badge 
                  [backgroundColorClass]="badgeProperty?.backgroundColorClass ?? null"
                  [indicatorColor]="badgeProperty?.indicatorColorClass ?? null"
                  [borderColorClass]="badgeProperty?.borderColorClass ?? null"
                  [textColorClass]="badgeProperty?.textColorClass ?? null" 
                  [isUpperCase]="true"
                  [status]="badgeProperty?.displayText ?? 'Unknown'">
                </ui-status-badge>
              </div>
              }

              @case ('custom') {
              @if (column.component) {
              <div class="flex items-center">
                <ui-dynamic-renderer 
                  [component]="column.component" 
                  [rowData]="item" 
                  [data]="column.customConfig?.data"
                  [rowPosition]="$index + 1" 
                  [isLastRow]="$last" 
                  (actionPerformed)="onRowActionPerformed($event)">
                </ui-dynamic-renderer>
              </div>
              }
              }

              @case ('actions') {
              <div class="flex items-center justify-center gap-2" [class]="getFlexJustify(column)">
                <!-- Icon Actions -->
                @if (column.actionsConfig?.iconActions) {
                @for (iconAction of column.actionsConfig?.iconActions; track iconAction) {
                <button type="button" (click)="onActionClicked(iconAction.actionKey, item, $event)"
                  class="flex items-center justify-center h-8 w-8 cursor-pointer rounded-lg hover:bg-gray-100 active:bg-gray-200 transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50"
                  [title]="iconAction.label || iconAction.actionKey">
                  <ui-svg-icon [src]="iconAction.iconPath" [size]="16" class="text-gray-600"></ui-svg-icon>
                </button>
                }
                }

                <!-- Three-dot Menu -->
                @if (column.actionsConfig?.threeDotMenuActions) {
                @let menuActions = getContextMenuActions(column.actionsConfig?.threeDotMenuActions, item);
                @if (menuActions.length > 0) {
                <ui-context-menu-button 
                  (actionClick)="onActionClicked($event, item, null)" 
                  [contextActions]="menuActions"
                  class="relative">
                  <button type="button"
                    class="flex items-center justify-center h-8 w-8 cursor-pointer rounded-lg hover:bg-gray-100 active:bg-gray-200 transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50"
                    title="More actions">
                    <svg class="w-4 h-4 text-gray-600" fill="currentColor" viewBox="0 0 20 20">
                      <path
                       d="M10 6a2 2 0 110-4 2 2 0 010 4zM10 12a2 2 0 110-4 2 2 0 010 4zM10 18a2 2 0 110-4 2 2 0 010 4z">
                      </path>
                    </svg>
                  </button>
                </ui-context-menu-button>
                }
                }

                <!-- Custom Components -->
                @if (column.actionsConfig?.components) {
                <div class="flex items-center gap-1">
                  @for (component of column.actionsConfig?.components; track $index) {
                  <ui-dynamic-renderer 
                    [component]="component" 
                    [rowData]="item" 
                    [data]="column.customConfig?.data"
                    [rowPosition]="$index + 1" 
                    [isLastRow]="$last" 
                    (actionPerformed)="onRowActionPerformed($event)">
                  </ui-dynamic-renderer>
                  }
                </div>
                }
              </div>
              }
              }
            </td>
            }

          </tr>

          <!-- Expanded Row -->
          @if (expandableComponent() && i === expandedRowIndex()) {
          <tr class="transition-all duration-700">
            <td
              [attr.colspan]="allLeafColumns().length + (enableRowSelection() ? 1 : 0) + (expandableComponent() ? 1 : 0)">
              <div class="mx-4 my-4 p-4 bg-gray-50 rounded-lg">
                <ui-dynamic-renderer 
                  [component]="expandableComponent()" 
                  [rowData]="item"
                  (actionPerformed)="onCellActionPerformed($event)">
                </ui-dynamic-renderer>
              </div>
            </td>
          </tr>
          }
          }
        </tbody>
        } @else {
        <!-- Empty State during loading - shows immediately -->
        <tbody class="relative z-0 flex-1">
          <tr class="h-full">
            <td
              [attr.colspan]="allLeafColumns().length + (enableRowSelection() ? 1 : 0) + (expandableComponent() ? 1 : 0)"
              class="h-full px-6 py-0 bg-gray-50 align-middle">
              <div class="h-full flex items-center justify-center">
                <div class="flex flex-col items-center space-y-6 max-w-md mx-auto">
                  <div class="flex items-center justify-center w-20 h-20 rounded-full bg-white shadow-lg border border-gray-200">
                    <svg class="w-10 h-10 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"
                        d="M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4">
                      </path>
                    </svg>
                  </div>
                  <div class="text-center space-y-3">
                    <h3 class="text-xl md:text-2xl font-bold text-gray-900 leading-tight">
                      No results found
                    </h3>
                    <p class="text-sm md:text-base text-gray-500 leading-relaxed">
                      @if (searchText) {
                      Try adjusting your search terms
                      } @else {
                      No records match your current filters
                      }
                    </p>
                    @if (enableSearch() && searchText) {
                    <div class="pt-2">
                      <button 
                        type="button"
                        class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-lg text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 transition-colors duration-200"
                        (click)="onClearSearch()">
                        Clear Search
                      </button>
                    </div>
                    }
                  </div>
                </div>
              </div>
            </td>
          </tr>
        </tbody>
        }
        }

        @case ('empty') {
        <!-- Component not ready -->
        <tbody class="relative z-0 flex-1">
          <tr class="h-full">
            <td
              [attr.colspan]="allLeafColumns().length + (enableRowSelection() ? 1 : 0) + (expandableComponent() ? 1 : 0)"
              class="h-full px-6 py-0 bg-gray-50 align-middle">
              <div class="h-full flex items-center justify-center">
                <div class="flex flex-col items-center space-y-6 max-w-md mx-auto">
                  <div class="flex items-center justify-center w-20 h-20 rounded-full bg-white shadow-lg border border-gray-200">
                    <svg class="w-10 h-10 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"
                        d="M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4">
                      </path>
                    </svg>
                  </div>
                  <div class="text-center space-y-3">
                    <h3 class="text-xl md:text-2xl font-bold text-gray-900 leading-tight">
                      No data available
                    </h3>
                    <p class="text-sm md:text-base text-gray-500 leading-relaxed">
                      Table is not configured yet
                    </p>
                  </div>
                </div>
              </div>
            </td>
          </tr>
        </tbody>
        }
        }
      </table>
    </div>
  </div>

  <!-- Footer - Always shows pagination, disabled during initial load only -->
  <div class="border-t-2 border-gray-300 bg-white px-6 py-4 flex-shrink-0">
    @if (enablePagination()) {
    <ui-pagination 
      [pageSize]="pageSize()" 
      [totalItems]="totalCount()" 
      (pageChange)="onPageChange($event)"
      >
    </ui-pagination>
    }

    @if (footerComponent()) {
    <ui-dynamic-renderer 
      [component]="footerComponent()" 
      [data]="data()" 
      (actionPerformed)="onFooterActionPerformed($event)">
    </ui-dynamic-renderer>
    }
  </div>
</div>